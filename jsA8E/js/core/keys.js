(function () {
  "use strict";

  function createApi() {
// Key mapping table from AtariIo.c (indexed by SDL 1.2 keysym.sym).
// Values are Atari POKEY KBCODE codes; 255 => unmapped.
var KEY_CODE_TABLE = [
  255,255,255,255,255,255,255,255, 52, 44,255,255,255, 12,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
   33,255,255,255,255,255,255,  6,255,255,255,255, 32, 54, 34, 38,
   50, 31, 30, 26, 24, 29, 27, 51, 53, 48,255,  2,255, 55,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255, 14,  7, 15,255,255,
   28, 63, 21, 18, 58, 42, 56, 61, 57, 13,  1,  5,  0, 37, 35,  8,
   10, 47, 40, 62, 45, 11, 16, 46, 22, 43, 23,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255, 17,255,255,255,255, 60,
   39,255,255,255,255,255,255,255,255,255,255,255,255, 60,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
];

function browserKeyToSdlSym(e) {
  // SDL 1.2 keysyms mostly follow ASCII for printable keys.
  var k = e.key;
  if (k && k.length === 1) return k.toLowerCase().charCodeAt(0) & 0x1ff;
  switch (k) {
    case "Enter":
      return 13;
    case "Backspace":
      return 8;
    case "Tab":
      return 9;
    case "Escape":
      return 27;
    case " ":
    case "Spacebar":
    case "Space":
      return 32;
    case "ArrowUp":
      return 273;
    case "ArrowDown":
      return 274;
    case "ArrowRight":
      return 275;
    case "ArrowLeft":
      return 276;
    case "F2":
      return 283;
    case "F3":
      return 284;
    case "F4":
      return 285;
    case "F5":
      return 286;
    case "F8":
      return 289;
    case "F11":
      return 292;
    case "Shift":
      // Prefer location-aware below; fall back to LSHIFT.
      return 304;
    case "Alt":
      return 308;
    case "Control":
      return 306; // SDLK_LCTRL (approx; unused for table)
    case "Meta":
      return 310; // SDLK_LMETA (approx; unused for table)
    default:
      break;
  }

  // Handle by code/location for modifiers.
  if (e.code === "ShiftRight") return 303;
  if (e.code === "ShiftLeft") return 304;
  if (e.code === "AltRight") return 307;
  if (e.code === "AltLeft") return 308;
  if (e.code === "MetaRight") return 309;
  if (e.code === "MetaLeft") return 310;

  return null;
}


    return {
      KEY_CODE_TABLE: KEY_CODE_TABLE,
      browserKeyToSdlSym: browserKeyToSdlSym,
    };
  }

  window.A8EKeys = {
    createApi: createApi,
  };
})();